# Product Requirement Document: Project Enterprise Nexus (v2.0 Ultimate)

**Version**: 2.0.0
**Role**: Senior Technical Architect
**Date**: 2026-01-26

---

## 1. é¡¹ç›®æ¦‚è¿° (Executive Summary)
**Project Enterprise Nexus** æ˜¯ä¸€ä¸ªåŸºäº **Next.js 16 (Web)** å’Œ **Tauri v2 (Desktop)** æ„å»ºçš„ä¼ä¸šçº§è¶…çº§åº”ç”¨ (Super App)ã€‚

**æ ¸å¿ƒç­–ç•¥**ï¼šé‡‡ç”¨ **"Source Code Fusion" (æºç èåˆ)** æ¨¡å¼ï¼Œå°†è¡Œä¸šé¡¶çº§çš„å¼€æºç³»ç»Ÿï¼ˆNocoDB, Plane, Midday, Medusa, ClassroomIO, AppFlowyï¼‰é›†æˆåˆ°ä¸€ä¸ª **Monorepo** ä¸­ã€‚é€šè¿‡ç»Ÿä¸€çš„ **PostgreSQL (Multi-Schema)**ã€**Redis**ã€**MinIO** å’Œ **Auth.js** ä½“ç³»ï¼Œå®ç°æ•°æ®äº’é€šã€UI ç»Ÿä¸€å’Œæ— ç¼äº¤äº’ã€‚

**ç›®æ ‡**ï¼šæ‰“é€ ä¸€ä¸ªç§æœ‰åŒ–éƒ¨ç½²çš„ã€æ¨¡å—åŒ–çš„ã€AI é©±åŠ¨çš„ä¼ä¸šæ“ä½œç³»ç»Ÿ (Enterprise OS)ã€‚

---

## 2. æŠ€æœ¯æ¶æ„è§„èŒƒ (Project Codex)

### 2.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ (The Speed Stack)
* **Core Framework**: **Next.js 16** (App Router) + React 19.
* **Bundler**: **Turbopack** (å¿…é¡»å¼ºåˆ¶å¼€å¯ `--turbo`). ğŸš€
* **Desktop Engine**: **Tauri v2** (Rust) - ç”¨äºæ„å»ºè·¨å¹³å°å®¢æˆ·ç«¯åŠå¤„ç†æœ¬åœ°ç³»ç»Ÿè°ƒç”¨ã€‚
* **Monorepo**: **Yarn v4 (Berry)** + **Turborepo** (ä»»åŠ¡ç¼“å­˜).
* **Styling**: **Tailwind CSS v4** + **Shadcn UI** (Zinc Theme).
* **State Management**:
    * **UI State**: Zustand (ä»…ç”¨äº Sidebar, Theme, Modal ç­‰äº¤äº’çŠ¶æ€).
    * **Server State**: TanStack Query v5 (é…åˆ Redis ç¼“å­˜).
* **Database**: **PostgreSQL v17** (Single Instance, Multi-Schema).
* **Infrastructure**:
    * **Cache/Queue**: **Redis v7** (Session Store, API Cache, BullMQ).
    * **Storage**: **MinIO** (S3 Compatible).
* **Auth & Permissions**: **Auth.js v5** (Identity) + **Directus** (RBAC Engine).

### 2.2 æ ¸å¿ƒæ¶æ„æ³•åˆ™ (The 12 Commandments)
1.  **åŸå­åŒ–è®¾è®¡ (Atomic Design)**: æ‰€æœ‰ UI ç»„ä»¶å¿…é¡»æ‹†è§£ä¸º `atoms`, `molecules`, `organisms`ã€‚ä¸¥ç¦è¶…è¿‡ 150 è¡Œçš„å·¨å‹ç»„ä»¶ã€‚
2.  **å•ä¸€æ•°æ®æº (SSOT)**: æ•°æ®åº“æ˜¯å”¯ä¸€çœŸç†ã€‚Redis ä»…ä½œç¼“å­˜ã€‚å‰ç«¯çŠ¶æ€å¿…é¡»é€šè¿‡ TanStack Query ä¸åç«¯ä¸¥æ ¼åŒæ­¥ã€‚
3.  **Server Actions First**: æ‰€æœ‰åç«¯äº¤äº’ï¼ˆDBè¯»å†™ã€å¤–éƒ¨APIï¼‰å¿…é¡»å°è£…ä¸º `"use server"` Actionsã€‚ä¸¥ç¦ä½¿ç”¨ä¼ ç»Ÿçš„ API Routes (`/pages/api`)ã€‚
4.  **Turbopack Enforced**: å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬å¿…é¡»åŒ…å« `--turbo`ã€‚
5.  **Rust Bridge**: æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿã€Shell å‘½ä»¤çš„æ“ä½œï¼Œå¿…é¡»é€šè¿‡ Tauri Rust Command å®ç°ï¼Œä¸¥ç¦åœ¨å‰ç«¯ä½¿ç”¨ Node.js APIã€‚
6.  **Schema Isolation**: ä¸åŒä¸šåŠ¡æ¨¡å—å¿…é¡»ä½¿ç”¨ç‹¬ç«‹çš„ Database Schema (å¦‚ `plane`, `nocodb`)ï¼Œä¸¥ç¦è¡¨åå†²çªã€‚

---

## 3. ç³»ç»Ÿæ¨¡å—çŸ©é˜µ (Module Matrix)

æ‰€æœ‰å­ç³»ç»Ÿå‡ä¸º **æºç å¼•å…¥**ï¼Œéœ€è¿›è¡Œ **Headless (æ— å¤´åŒ–)** æ”¹é€ ï¼ˆç§»é™¤åŸæœ‰çš„ Layout/Sidebarï¼‰ï¼Œä½œä¸ºç»„ä»¶åµŒå…¥ Portalã€‚

| æ¨¡å—åç§° | åŸå§‹é¡¹ç›® | èŒè´£å®šä½ | DB Schema | å­˜å‚¨æ¡¶ (Bucket) | æ”¹é€ è¦ç‚¹ |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Portal** | **Next.js 16** | **OS / ä¸»æ§å°** | `auth` | `nexus-public` | è´Ÿè´£å¯¼èˆªã€ç™»å½•ã€AI Copilotã€å…¨å±€æœç´¢ |
| **CRM** | **NocoDB** | å®¢æˆ·ç®¡ç† | `nocodb` | `nexus-crm` | ç§»é™¤ Navbar/Sidebarï¼Œå¯¹æ¥å…±äº« Cookie |
| **OKR** | **Plane** | ç›®æ ‡ä¸é¡¹ç›® | `plane` | `nexus-okr` | ç§»é™¤ AppSidebarï¼Œä»…ä¿ç•™ Cycle/Module è§†å›¾ |
| **Finance** | **Midday** | è´¢åŠ¡ä¸å‘ç¥¨ | `midday` | `nexus-finance` | å¤ç”¨ Portal çš„ UI ç»„ä»¶ï¼Œè¿æ¥ç»Ÿä¸€ PG |
| **Inventory**| **MedusaJS** | äº§å“ä¸åº“å­˜ | `medusa` | `nexus-products`| ä»…ä¿ç•™ Admin åå°ï¼Œç§»é™¤ Storefront |
| **LMS** | **ClassroomIO**| åŸ¹è®­ç³»ç»Ÿ | `classroomio`| `nexus-lms` | ç§»é™¤ Dashboard Layoutï¼ŒåµŒå…¥ Portal |
| **Docs** | **AppFlowy** | çŸ¥è¯†åº“ | `appflowy` | `nexus-docs` | ä½¿ç”¨ Web ç‰ˆï¼Œæ³¨å…¥ CSS éšè—è¾¹æ¡† |
| **Admin** | **Directus** | æƒé™/é…ç½® | `public` | `nexus-sys` | åå°ç®¡ç†ï¼Œä¸é¢å‘æ™®é€šå‘˜å·¥ |

---

## 4. æ•°æ®ä¸å­˜å‚¨ç­–ç•¥ (Unified Data Strategy)

### 4.1 æ•°æ®åº“ (PostgreSQL)
* **è¿æ¥æ–¹å¼**: æ‰€æœ‰åº”ç”¨è¿æ¥åŒä¸€ä¸ª PostgreSQL å®ä¾‹ URLã€‚
* **Prisma é…ç½®**: ä½¿ç”¨ `previewFeatures = ["multiSchema"]`ï¼Œåœ¨ `schema.prisma` ä¸­ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ¨¡å—çš„ Schemaã€‚

### 4.2 ç¼“å­˜ä¸é˜Ÿåˆ— (Redis)
* **Session Store**: Auth.js çš„ Session Token å¿…é¡»å­˜å‚¨åœ¨ Redis ä¸­ï¼Œå®ç°æ— çŠ¶æ€é‰´æƒï¼Œç¡®ä¿å­ç³»ç»Ÿèƒ½é€šè¿‡ Cookie å…±äº«ç™»å½•æ€ã€‚
* **API Cache**: é«˜é¢‘æ•°æ®ï¼ˆå¦‚ Dashboard ç»Ÿè®¡ï¼‰ç¼“å­˜ 60ç§’ã€‚
* **Job Queue**: ä½¿ç”¨ BullMQ å¤„ç†è€—æ—¶ä»»åŠ¡ï¼ˆå¦‚ Midday PDF ç”Ÿæˆã€NocoDB å¯¼å…¥ï¼‰ã€‚

### 4.3 æ–‡ä»¶å­˜å‚¨ (MinIO)
* **åè®®**: S3 Compatible SDKã€‚
* **ç­–ç•¥**: Portal æä¾›ç»Ÿä¸€çš„ `packages/storage` å®¢æˆ·ç«¯ã€‚æ‰€æœ‰å­ç³»ç»Ÿä¸¥ç¦ä½¿ç”¨æœ¬åœ°ç£ç›˜å­˜å‚¨ (`fs.write`)ï¼Œå¿…é¡»ä¸Šä¼ è‡³ MinIOã€‚

---

## 5. ç›®å½•ç»“æ„ (Directory Structure)

```text
/
â”œâ”€â”€ package.json          # Yarn Workspaces
â”œâ”€â”€ turbo.json            # Turborepo Cache Config
â”œâ”€â”€ docker-compose.yml    # Infrastructure (PG, Redis, MinIO, Directus)
â”œâ”€â”€ schema.prisma         # Unified DB Schema (Multi-Schema)
â”‚
â”œâ”€â”€ apps/                 # åº”ç”¨ç¨‹åºå±‚
â”‚   â”œâ”€â”€ portal/           # [Next.js] ä¸»æ§å° (Running with --turbo)
â”‚   â”œâ”€â”€ plane/            # [Next.js] OKR ç³»ç»Ÿæºç 
â”‚   â”œâ”€â”€ nocodb/           # [Nuxt] CRM ç³»ç»Ÿæºç 
â”‚   â”œâ”€â”€ midday/           # [Next.js] è´¢åŠ¡ç³»ç»Ÿæºç 
â”‚   â”œâ”€â”€ inventory/        # [React] Medusa Admin æºç 
â”‚   â”œâ”€â”€ learning/         # [Next.js] ClassroomIO æºç 
â”‚   â””â”€â”€ docs/             # [Flutter/Web] AppFlowy Web æºç 
â”‚
â”œâ”€â”€ src-tauri/            # [Rust] Tauri v2 åç«¯ä»£ç 
â”‚
â””â”€â”€ packages/             # å…±äº«åº“å±‚
    â”œâ”€â”€ ui/               # [Shared] Shadcn UI ç»„ä»¶åº“ (Zinc Theme)
    â”œâ”€â”€ db/               # [Shared] Prisma Client (Multi-Schema)
    â”œâ”€â”€ redis/            # [Shared] Redis Client (ioredis + BullMQ)
    â”œâ”€â”€ storage/          # [Shared] MinIO Client (S3 SDK)
    â”œâ”€â”€ auth/             # [Shared] Auth.js é…ç½®
    â””â”€â”€ tailwind-config/  # [Shared] ç»Ÿä¸€ Tailwind é…ç½®

## 6. åŠŸèƒ½éœ€æ±‚ç»†èŠ‚ (Functional Specs)

### 6.1 ä¸»æ§å° (Portal)

1. **App Shell**: æä¾›å…¨å±€ä¾§è¾¹æ  (Sidebar)ã€é¡¶æ  (Header) å’Œ é¢åŒ…å±‘ (Breadcrumbs)ã€‚èœå•å†…å®¹ç”± **Directus** åŠ¨æ€æ§åˆ¶ã€‚
2. **AI Copilot**: åŸºäº Windsurf/LangChain çš„å…¨å±€æµ®çª—ï¼Œå¯è¯»å–å½“å‰é¡µé¢ä¸Šä¸‹æ–‡ï¼ˆå¦‚å½“å‰æ‰“å¼€çš„ NocoDB è¡¨æ ¼ï¼‰ï¼Œè¿›è¡Œæ•°æ®åˆ†æã€‚
3. **Global Search (Cmd+K)** : èšåˆæœç´¢ Plane Issues, NocoDB Rows, AppFlowy Docsã€‚

### 6.2 æƒé™èåˆ (RBAC)

1. **Directus å®šä¹‰**: åœ¨ Directus ä¸­å®šä¹‰â€œè§’è‰²â€ (Roles) å’Œâ€œæƒé™ç­–ç•¥â€ (Policies)ã€‚
2. **Next.js æ‰§è¡Œ**: Portal å¯åŠ¨æ—¶è·å–å½“å‰ç”¨æˆ·çš„æƒé™æ ‘ã€‚

   - å¦‚æœæœ‰ `finance:read` æƒé™ -\> æ¸²æŸ“ Midday èœå•ã€‚
   - å¦‚æœæ²¡æœ‰ -\> éšè—èœå•ï¼Œæ‹¦æˆªè·¯ç”±ã€‚

### 6.3 è‡ªåŠ¨åŒ–æµè½¬ (Automation)

1. **ç”¨æˆ·åŒæ­¥**: Portal æ³¨å†Œæ–°ç”¨æˆ· -\> è§¦å‘ Server Action -\> åœ¨ `plane.users`, `nocodb.users` ç­‰è¡¨ä¸­åŒæ­¥åˆ›å»ºè®°å½• (ID æ˜ å°„)ã€‚
2. **ä¸šåŠ¡è”åŠ¨**: é”€å”®æˆäº¤ (NocoDB) -\> è§¦å‘ Webhook -\> æ‰£å‡åº“å­˜ (Medusa) -\> ç”Ÿæˆå‘ç¥¨ (Midday)ã€‚

---

## 7. å¼€å‘è„šæœ¬è§„èŒƒ (Dev Scripts)

**æ³¨æ„ï¼šTurbopack å¿…é¡»å¼ºåˆ¶å¼€å¯ã€‚**

Root `package.json`:

JSON

```
{
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "start": "turbo start"
  }
}
```

Apps `package.json` (e.g., `apps/portal`):

JSON

```
{
  "scripts": {
    "dev": "next dev --turbo",  // <--- CRITICAL
    "build": "next build"
  }
}
```
