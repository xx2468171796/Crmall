# Product Requirement Document: Project Enterprise Nexus (v2.0)

## 1. é¡¹ç›®æ¦‚è¿° (Executive Summary)
**Project Nexus** æ˜¯ä¸€ä¸ªåŸºäº **Next.js 16 (Web)** å’Œ **Tauri v2 (Desktop)** çš„ä¼ä¸šçº§è¶…çº§åº”ç”¨ (Super App)ã€‚
æœ¬é¡¹ç›®é‡‡ç”¨ **"Source Code Fusion" (æºç èåˆ)** ç­–ç•¥ï¼Œå°†å¤šä¸ªé¡¶çº§å¼€æºé¡¹ç›®é›†æˆåˆ°ä¸€ä¸ª **Monorepo** ä¸­ã€‚ç³»ç»Ÿå…±äº«åŒä¸€ä¸ªæ•°æ®åº“ã€åŒä¸€ä¸ªç¼“å­˜å±‚ã€åŒä¸€ä¸ªæ–‡ä»¶å­˜å‚¨ä»¥åŠç»Ÿä¸€çš„èº«ä»½è®¤è¯ä½“ç³»ã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼šæ‰“é€ ä¸€ä¸ªæ— ç¼çš„ã€æ¨¡å—åŒ–çš„ã€ç§æœ‰åŒ–éƒ¨ç½²çš„ä¼ä¸šæ“ä½œç³»ç»Ÿ (Enterprise OS)ã€‚

---

## 2. æŠ€æœ¯æ¶æ„è§„èŒƒ (Project Codex Standards)

### 2.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ (The Speed Stack)
* **Core Framework**: **Next.js 16** (App Router) + React 19.
* **Bundler**: **Turbopack** (Must be enabled via `--turbo`). ğŸš€
* **Monorepo Tool**: **Turborepo** (ä»»åŠ¡ç¼“å­˜) + **Yarn v4** (Workspaces).
* **Desktop Engine**: **Tauri v2** (Rust) - ç”¨äºæ„å»º Mac/Windows å®¢æˆ·ç«¯ä¸æœ¬åœ°ç³»ç»Ÿäº¤äº’ã€‚
* **Styling**: **Tailwind CSS v4** + **Shadcn UI** (Zinc Theme).
* **State Management**:
    * **UI State**: Zustand (ä»…ç”¨äº UI äº¤äº’/ä¸»é¢˜çŠ¶æ€).
    * **Server State**: TanStack Query v5 (é…åˆ Redis ç¼“å­˜).
* **Database**: **PostgreSQL v17** (Single Instance, Multi-Schema).
* **Infrastructure**:
    * **Cache & Queue**: **Redis v7** (Session, API Cache, BullMQ).
    * **Storage**: **MinIO** (S3 Compatible).
* **Auth & Permissions**: **Auth.js v5** (Identity) + **Directus** (RBAC/Policy Engine).

### 2.2 æ ¸å¿ƒæ¶æ„æ³•åˆ™
1.  **åŸå­åŒ–è®¾è®¡ (Atomic Design)**: ç»„ä»¶å¿…é¡»æ‹†è§£ä¸º atoms/molecules/organismsã€‚ä¸¥ç¦å·¨å‹ç»„ä»¶ã€‚
2.  **å•ä¸€æ•°æ®æº (SSOT)**: æ•°æ®åº“æ˜¯å”¯ä¸€çœŸç†ã€‚Redis ä»…ä½œç¼“å­˜ï¼Œå‰ç«¯çŠ¶æ€å¿…é¡»ä¸åç«¯åŒæ­¥ã€‚
3.  **Server Actions**: æ‰€æœ‰åç«¯äº¤äº’å¿…é¡»å°è£…ä¸º "use server" Actionsï¼Œä¸¥ç¦ä½¿ç”¨ä¼ ç»Ÿçš„ API Routesã€‚
4.  **Rust Bridge**: æ¶‰åŠæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€Shell å‘½ä»¤çš„æ“ä½œï¼Œå¿…é¡»é€šè¿‡ Tauri Rust Command å®ç°ã€‚

---

## 3. ç³»ç»Ÿæ¨¡å—çŸ©é˜µ (Module Matrix)

æ‰€æœ‰å­ç³»ç»Ÿå‡é€šè¿‡æºç å¼•å…¥ï¼Œè¿›è¡Œ **"Headless" (æ— å¤´åŒ–)** æ”¹é€ ï¼ˆç§»é™¤åŸæœ‰ Sidebar/Headerï¼‰ï¼Œä½œä¸ºç»„ä»¶åµŒå…¥ Portalã€‚

| æ¨¡å—åç§° | å¼€æºé¡¹ç›®æº | èŒè´£ | æ•°æ®åº“ Schema | å­˜å‚¨æ¡¶ (Bucket) | æ”¹é€ è¦ç‚¹ |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Portal** | **Next.js 16** | **ä¸»æ§å°/OS** | `auth` | `nexus-public` | è´Ÿè´£å¯¼èˆªã€ç™»å½•ã€AI æµ®çª—ã€å…¨å±€æœç´¢ |
| **CRM** | **NocoDB** | å®¢æˆ·ç®¡ç† | `nocodb` | `nexus-crm` | ç§»é™¤ Navbarï¼Œå¯¹æ¥å…±äº« Cookie |
| **OKR** | **Plane** | ç›®æ ‡ç®¡ç† | `plane` | `nexus-okr` | ç§»é™¤ Sidebarï¼Œä»…ä¿ç•™ Cycle/Module è§†å›¾ |
| **Finance** | **Midday** | è´¢åŠ¡å‘ç¥¨ | `midday` | `nexus-finance` | å¤ç”¨ UI ç»„ä»¶ï¼Œè¿æ¥ç»Ÿä¸€ Postgres |
| **Inventory** | **MedusaJS** | åº“å­˜äº§å“ | `medusa` | `nexus-products` | ä»…ä¿ç•™ Admin åå°ï¼Œç§»é™¤ Storefront |
| **Learning** | **ClassroomIO** | åŸ¹è®­ç³»ç»Ÿ | `classroomio` | `nexus-lms` | ç§»é™¤ Dashboard Layoutï¼ŒåµŒå…¥ Portal |
| **Docs** | **AppFlowy** | çŸ¥è¯†åº“ | `appflowy` | `nexus-docs` | ä½¿ç”¨ Web ç‰ˆï¼Œæ³¨å…¥ CSS éšè—è¾¹æ¡† |
| **Admin** | **Directus** | æƒé™/é…ç½® | `public` | `nexus-sys` | åå°ç®¡ç†ï¼Œä¸ç›´æ¥é¢å‘æ™®é€šç”¨æˆ· |

---

## 4. æ•°æ®ä¸å­˜å‚¨ç­–ç•¥ (Unified Data Strategy)

### 4.1 æ•°æ®åº“ (PostgreSQL)
* **å•ä¸€å®ä¾‹**: æ‰€æœ‰åº”ç”¨è¿æ¥åŒä¸€ä¸ª PG URLã€‚
* **Schema éš”ç¦»**: å„å­ç³»ç»Ÿä½¿ç”¨ç‹¬ç«‹çš„ Schemaï¼Œé€šè¿‡ Prisma çš„ `previewFeatures = ["multiSchema"]` è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚

### 4.2 ç¼“å­˜ä¸æ¶ˆæ¯é˜Ÿåˆ— (Redis Strategy)
* **Session Store**: Auth.js çš„ Session Token å­˜å‚¨åœ¨ Redisï¼Œå®ç°æ— çŠ¶æ€é‰´æƒã€‚
* **API Caching**: é«˜é¢‘ Dashboard æ•°æ®ç¼“å­˜ 60sã€‚
* **Job Queue**: ä½¿ç”¨ BullMQ å¤„ç† Midday å‘ç¥¨ç”Ÿæˆã€NocoDB Excel å¯¼å…¥ç­‰è€—æ—¶ä»»åŠ¡ã€‚

### 4.3 æ–‡ä»¶å­˜å‚¨ (MinIO Strategy)
* **S3 Protocol**: ä¸¥ç¦ä½¿ç”¨æœ¬åœ°ç£ç›˜ (`fs.write`)ã€‚æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å¿…é¡»èµ° S3 SDKã€‚
* **Unified Manager**: Portal æä¾›ç»Ÿä¸€çš„â€œæ–‡ä»¶ç®¡ç†å™¨â€ç•Œé¢ï¼ŒæŸ¥çœ‹æ‰€æœ‰ Bucket çš„å†…å®¹ã€‚

---

## 5. æƒé™ä¸èåˆé€»è¾‘ (Auth & Integration)

### 5.1 ç»Ÿä¸€èº«ä»½ (Identity)
* **Auth.js**: è´Ÿè´£ç™»å½•/æ³¨å†Œ/æ³¨é”€ã€‚
* **Sync Action**: ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œè§¦å‘ n8n æˆ– Server Actionï¼Œè‡ªåŠ¨åœ¨ Plane/NocoDB/Medusa çš„ç”¨æˆ·è¡¨ä¸­åˆ›å»ºå¯¹åº”è®°å½• (ID æ˜ å°„)ã€‚

### 5.2 æƒé™å¼•æ“ (Directus)
* **Role Source**: ç”¨æˆ·è§’è‰² (å¦‚â€œé”€å”®æ€»ç›‘â€) åœ¨ Directus ä¸­å®šä¹‰ã€‚
* **Menu Control**: Portal å¯åŠ¨æ—¶è°ƒç”¨ Directus APIï¼Œè·å–å½“å‰ç”¨æˆ·å¯è®¿é—®çš„ **æ¨¡å—åˆ—è¡¨** å’Œ **åŠŸèƒ½å¼€å…³**ï¼ŒåŠ¨æ€æ¸²æŸ“ä¾§è¾¹æ ã€‚

### 5.3 æ ·å¼èåˆ (Theming)
* **CSS Variables**: åœ¨ Portal çš„ `globals.css` å®šä¹‰ `--primary`, `--secondary`, `--radius`ã€‚
* **Tailwind Config**: ä¿®æ”¹æ‰€æœ‰å­ç³»ç»Ÿçš„ `tailwind.config.js`ï¼Œä½¿å…¶è¯»å–ä¸Šè¿° CSS å˜é‡ï¼Œå®ç°ä¸€é”®æ¢è‚¤ã€‚

---

## 6. ç›®å½•ç»“æ„ (Directory Structure)

```text
/
â”œâ”€â”€ package.json          # Yarn Workspaces
â”œâ”€â”€ turbo.json            # Turborepo Cache Config
â”œâ”€â”€ docker-compose.yml    # Infrastructure (PG, Redis, MinIO, Directus)
â”œâ”€â”€ schema.prisma         # Unified DB Schema (Multi-Schema)
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ portal/           # [Next.js] ä¸»æ§å° (Running with --turbo)
â”‚   â”œâ”€â”€ plane/            # [Next.js] OKR ç³»ç»Ÿ
â”‚   â”œâ”€â”€ nocodb/           # [Nuxt] CRM ç³»ç»Ÿ
â”‚   â”œâ”€â”€ midday/           # [Next.js] è´¢åŠ¡ç³»ç»Ÿ
â”‚   â”œâ”€â”€ inventory/        # [React] Medusa Admin
â”‚   â”œâ”€â”€ learning/         # [Next.js] ClassroomIO
â”‚   â””â”€â”€ docs/             # [Flutter/Web] AppFlowy
â”‚
â””â”€â”€ packages/
    â”œâ”€â”€ ui/               # [Shared] Shadcn UI ç»„ä»¶åº“
    â”œâ”€â”€ db/               # [Shared] Prisma Client
    â”œâ”€â”€ redis/            # [Shared] Redis Client (ioredis)
    â”œâ”€â”€ storage/          # [Shared] MinIO Client (S3 SDK)
    â”œâ”€â”€ auth/             # [Shared] Auth.js é…ç½®
    â””â”€â”€ tailwind-config/  # [Shared] ç»Ÿä¸€ Tailwind é…ç½®


## 7. å¼€å‘è„šæœ¬è§„èŒƒ (Dev Scripts)

**å¼ºåˆ¶å¼€å¯ Turbopack** ä»¥ä¿è¯å¼€å‘ä½“éªŒã€‚

`package.json` (Root):

JSON

```
{
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build"
  }
}
```

`apps/portal/package.json` (åŠå…¶ä»– Next.js å­åº”ç”¨):

JSON

```
{
  "scripts": {
    "dev": "next dev --turbo", 
    "build": "next build"
  }
}
```

---
