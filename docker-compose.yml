version: "3.8"

services:
  # ===========================================
  # Directus - RBAC Engine
  # ===========================================
  directus:
    image: directus/directus:11.4
    container_name: nexus-directus
    ports:
      - "8055:8055"
    environment:
      SECRET: "nexus-directus-secret-change-in-production"
      ADMIN_EMAIL: "admin@nexus.local"
      ADMIN_PASSWORD: "xx123654"
      DB_CLIENT: "pg"
      DB_HOST: "192.168.110.246"
      DB_PORT: "5433"
      DB_DATABASE: "crmall0125"
      DB_USER: "crmall0125"
      DB_PASSWORD: "xx123654"
      DB_SCHEMA: "public"
      CACHE_ENABLED: "true"
      CACHE_STORE: "redis"
      REDIS_HOST: "192.168.110.246"
      REDIS_PORT: "6379"
      REDIS_PASSWORD: "xx123654"
      CORS_ENABLED: "true"
      CORS_ORIGIN: "http://localhost:3000,http://127.0.0.1:3000"
      PUBLIC_URL: "http://localhost:8055"
    volumes:
      - directus_uploads:/directus/uploads
    restart: unless-stopped

  # ===========================================
  # NocoDB - CRM (No-Code Database)
  # ===========================================
  nocodb:
    image: nocodb/nocodb:latest
    container_name: nexus-nocodb
    ports:
      - "8080:8080"
    environment:
      NC_DB: "pg://192.168.110.246:5433?u=crmall0125&p=xx123654&d=crmall0125&schema=nocodb"
      NC_REDIS_URL: "redis://:xx123654@192.168.110.246:6379"
      NC_DISABLE_TELE: "true"
      NC_AUTH_JWT_SECRET: "nexus-nocodb-jwt-secret-change-in-production"
    volumes:
      - nocodb_data:/usr/app/data
    restart: unless-stopped

volumes:
  directus_uploads:
  nocodb_data:
